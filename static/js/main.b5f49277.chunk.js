(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{130:function(e,t,a){e.exports=a(266)},139:function(e,t,a){},145:function(e,t,a){},146:function(e,t,a){},263:function(e,t,a){},264:function(e,t,a){},265:function(e,t,a){},266:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(52),s=a.n(r),i=a(37),l=a(54),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CSV_UPLOADED":return t.payload;default:return e}},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"VECTORS_UPDATED":return t.payload;default:return e}},p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SUFFIX_OBTAINED":return t.payload;default:return e}},h=Object(i.b)({csvUrl:c,vectorsOnMap:u,fileSuffix:p}),f=a(14),d=a(15),m=a(17),v=a(16),g=a(18),b=(a(139),function(e){function t(){return Object(f.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"footer fixed-bottom"},o.a.createElement("h5",{className:"footer-text"},o.a.createElement("a",{href:"http://data.naturalcapitalproject.org/nightly-build/invest-users-guide/html/habitat_risk_assessment.html",target:"blank"},"InVEST User Guide "),"\xa9",o.a.createElement("a",{href:"https://naturalcapitalproject.stanford.edu/",target:"blank"},"2019 Natural Capital Project")))}}]),t}(o.a.Component)),y=a(92),S=a(38),E=a(124),O=a(125),k=a.n(O),x=a(126),R=a.n(x),j=a(4),C=a(24),M=a(3),_=M.Control.extend({options:{className:"",onOff:"",handleOff:function(){}},onAdd:function(){var e=M.DomUtil.create("div",this.options.className);return M.DomEvent.disableClickPropagation(e),e},onRemove:function(e){return this.options.onOff&&e.off(this.options.onOff,this.options.handleOff,this),this}}),A=Object(j.c)(function(e){function t(){return Object(f.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(d.a)(t,[{key:"createLeafletElement",value:function(e){return new _(Object.assign({},e))}},{key:"componentDidMount",value:function(){this.forceUpdate(),this.leafletElement.addTo(this.props.leaflet.map)}},{key:"render",value:function(){return this.leafletElement&&this.leafletElement.getContainer()?s.a.createPortal(this.props.children,this.leafletElement.getContainer()):null}}]),t}(C.a)),T=function(e){return{type:"CSV_UPLOADED",payload:e}},L=function(e){return{type:"VECTORS_UPDATED",payload:e}},N=function(e){return{type:"SUFFIX_OBTAINED",payload:e}},w=a(66),I=a(93),U=a(95),D=a(94),F=(a(143),a(144),a(145),w.b.BaseLayer),B=["#fff","#aa0101"],P=k.a.scale(B).colors(4),H=[0,3],V={0:"No Score",1:"Low Risk",2:"Medium Risk",3:"High Risk"},W=["#d95f0e","#d95f0e"],G=[1,1],K=["RECLASS_RISK_Ecosystem.geojson","RECLASS_RISK_eelgrass.geojson","RECLASS_RISK_kelp.geojson","RECLASS_RISK_hardbottom.geojson","RECLASS_RISK_softbottom.geojson","STRESSOR_Docks_Wharves_Marinas.geojson","STRESSOR_Finfish_Aquaculture_Comm.geojson","STRESSOR_Rec_Fishing.geojson","STRESSOR_Shellfish_Aquaculture_Comm.geojson","SUMMARY_STATISTICS.csv"],z="RECLASS_RISK_Ecosystem",Z=function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={mapid:"mapdiv",coordText:"Hover mouse over the map to display coordinates.",maxZoom:18,minZoom:2,maxBbox:[[-90,-180],[90,180]],lats:[],lngs:[],vectors:{},vectorLength:null,vectorsOnMap:[],rasters:{},rasterLength:null,rastersOnMap:[],colorScale:[],colorRange:[],ecosystemRiskLayer:z,fileSuffix:""},a.mapRef=o.a.createRef(),a.layerControl=o.a.createRef(),a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.mapApi=this.mapRef.current.leafletElement,this.renderLegend()}},{key:"onFileUpload",value:function(e,t){for(var a=this,n={},o=null,r="",s=0;s<Object.keys(this.state.rastersOnMap).length;s++){var i=this.state.rastersOnMap[s];this.state.rasters[i].removeFrom(this.mapApi)}t?e.forEach(function(e){var t=e.split(".").pop(),a=e.split(".")[1].split("/").pop();"geojson"===t?n[a]=e:"csv"===t&&(o=e)}):Object.values(e).forEach(function(e){var t=e.name,a=t.split(".").pop(),s=t.replace("."+a,"");"geojson"===a?n[s]=URL.createObjectURL(e):"tif"===a||"csv"===a&s.startsWith("SUMMARY_STATISTICS")&&(o=URL.createObjectURL(e),r=s.slice("SUMMARY_STATISTICS".length))}),this.setState({vectors:{},vectorLength:null,vectorsOnMap:[],rasters:{},rasterLength:null,rastersOnMap:[],lats:[],lngs:[],maxBbox:[[-90,-180],[90,180]],fileSuffix:r,ecosystemRiskLayer:"RECLASS_RISK_Ecosystem"+r},function(){a.loadVectors(n)}),this.props.getCsvUrl(o),this.props.getFileSuffix(r)}},{key:"viewSample",value:function(e){var t=K.map(function(e){return"./data/"+e});this.onFileUpload(t,!0)}},{key:"loadVectors",value:function(e){var t=this,a=[],n=[],r={};this.setState({vectorLength:Object.keys(e).length}),Object.keys(e).forEach(function(s){var i=e[s];fetch(i).then(function(e){return e.json()}).then(function(e){e.name.startsWith("RECLASS_RISK_")?t.setState({colorScale:B,colorRange:H}):e.name.startsWith("STRESSOR_")&&t.setState({colorScale:W,colorRange:G}),r[s]=o.a.createElement(R.a,{key:e.name,data:{type:"FeatureCollection",features:e.features},valueProperty:function(e){return s.startsWith("RECLASS_RISK_")?e.properties["Risk Score"]:s.startsWith("STRESSOR_")?e.properties.Stressor:void 0},scale:t.state.colorScale,steps:4,range:t.state.colorRange,mode:"e",style:t.getPolygonStyle(),onEachFeature:function(e,a){return t.popupText(e,a)}});var i=Object(E.bbox)(e);n.push.apply(n,[i[0],i[2]]),a.push.apply(a,[i[1],i[3]]),Object.values(r).length===t.state.vectorLength&&t.setState({vectorsOnMap:[].concat(Object(S.a)(t.state.vectorsOnMap),[t.state.ecosystemRiskLayer]),vectors:r,lngs:n,lats:a},function(){t.props.getVectorsOnMap(t.state.vectorsOnMap),t.updateMaxBbox()})})})}},{key:"updateMaxBbox",value:function(){if(this.state.lats.length>0&&this.state.lngs.length>0){var e=Math.min.apply(Math,Object(S.a)(this.state.lats)),t=Math.max.apply(Math,Object(S.a)(this.state.lats)),a=Math.min.apply(Math,Object(S.a)(this.state.lngs)),n=Math.max.apply(Math,Object(S.a)(this.state.lngs));this.setState({maxBbox:[[e,a],[t,n]]})}}},{key:"getPolygonStyle",value:function(){return{weight:.5,opacity:.8,color:"black",fillColor:"rgba(255, 255, 255, 0)",fillOpacity:.8}}},{key:"popupText",value:function(e,t){var a=e.properties;Object.keys(a).forEach(function(e){if("Risk Score"===e){var n=a[e];t.bindPopup(V[n])}else t.bindPopup(e)})}},{key:"renderGeojsons",value:function(){var e=this.state.vectors,t=this.state.vectorsOnMap,a=[];return Object.keys(e).forEach(function(n){t.includes(n)&&a.push(e[n])}),a}},{key:"addLayerControls",value:function(){var e,t=this,a=this.state.vectors,n=this.state.vectorsOnMap,r=this.state.ecosystemRiskLayer,s=[],i=(e={},Object(y.a)(e,"RECLASS_RISK_","Habitat Risk"),Object(y.a)(e,"STRESSOR_","Stressor"),e);r in a&&s.push(o.a.createElement("label",{key:r},o.a.createElement("div",null,o.a.createElement("input",{type:"radio",value:r,ref:r,className:"leaflet-control-layers-selector",defaultChecked:!0,onClick:this.handleVectorLayer.bind(this)}),o.a.createElement("span",{className:"bold-font"},r.replace("RECLASS_RISK_","")+" Risk"))));var l=function(e){s.push(o.a.createElement("div",{key:e,className:"control-layer-header"},i[e])),Object.keys(a).forEach(function(a){if(a.startsWith(e)&a!==r){if(n.includes(a));s.push(o.a.createElement("label",{key:a},o.a.createElement("div",null,o.a.createElement("input",{type:"checkbox",value:a,ref:a,className:"leaflet-control-layers-selector",defaultChecked:!1,onClick:t.handleVectorLayer.bind(t)}),o.a.createElement("span",null,a.replace(e,"")))))}})};for(var c in i)l(c);if(s.length>2)return o.a.createElement(A,{position:"topright"},o.a.createElement("div",{className:"leaflet-control-layers\r leaflet-control-layers-expanded indent-box"},s))}},{key:"handleRasterLayer",value:function(e){var t=e.target.value;this.state.rastersOnMap.includes(t)?(this.setState({rastersOnMap:this.state.rastersOnMap.filter(function(e){return e!==t})}),this.state.rasters[t].removeFrom(this.mapApi)):(this.setState({rastersOnMap:[].concat(Object(S.a)(this.state.rastersOnMap),[t])}),this.state.rasters[t].addTo(this.mapApi))}},{key:"handleVectorLayer",value:function(e){var t=this,a=e.target.value,n=this.state.vectorsOnMap,o=Object(S.a)(this.state.vectorsOnMap),r=this.state.ecosystemRiskLayer;if(n.includes(a)){var s=o.indexOf(a);a===r&&(this.refs[r].checked=!1),-1!==s&&o.splice(s,1)}else{if(a===r)for(var i=o.length-1;i>=0;i--){var l=o[i];if(l.startsWith("RECLASS_RISK_")){var c=o.indexOf(l);o.splice(c,1),this.refs[l].checked=!1}}else if(n.includes(r)&a.startsWith("RECLASS_RISK_")){var u=o.indexOf(r);o.splice(u,1),this.refs[r].checked=!1}o.push(a)}this.setState({vectorsOnMap:o},function(){t.props.getVectorsOnMap(t.state.vectorsOnMap)})}},{key:"renderMouseCoords",value:function(e){var t="Lat: "+e.latlng.lat.toFixed(5)+", Long: "+e.latlng.lng.toFixed(5);this.setState({coordText:t})}},{key:"removeCoords",value:function(e){this.setState({coords:"Hover mouse over the map to display coordinates."})}},{key:"zoomToMaxBbox",value:function(){this.mapApi.fitBounds(this.state.maxBbox)}},{key:"renderLegend",value:function(){var e=[];Object.keys(V).forEach(function(t){var a=V[t],n=P[t];e.push(o.a.createElement("li",{key:a},o.a.createElement("svg",{className:"legend-svg"},o.a.createElement("rect",{className:"legend-svg",width:"28px",height:"18px",fill:n})),o.a.createElement("span",{className:"legend-text"},a)))}),e.push(o.a.createElement("li",{key:"stressor"},o.a.createElement("svg",{className:"legend-svg"},o.a.createElement("rect",{className:"legend-svg",width:"28px",height:"18px",fill:W[0]})),o.a.createElement("span",{className:"legend-text"},"Stressor"))),this.setState({legend:e})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement(I.a,{ref:this.mapRef,id:this.state.mapid,className:"map",maxZoom:this.state.maxZoom,minZoom:this.state.minZoom,onMouseMove:this.renderMouseCoords.bind(this),onMouseOut:this.removeCoords.bind(this),style:{backgroundColor:"#aad3df"},bounds:this.state.maxBbox},o.a.createElement(A,{position:"topleft"},o.a.createElement("button",{id:"zoom-btn",title:"Zoom To AOI","aria-label":"Zoom To AOI",onClick:this.zoomToMaxBbox.bind(this)},o.a.createElement("i",{className:"fa fa-crosshairs fa-lg"}))),o.a.createElement(w.b,{position:"topleft"},o.a.createElement(F,{name:"Open Street Map",checked:!0},o.a.createElement(U.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">\r OpenStreetMap</a> contributors'})),o.a.createElement(F,{name:"ESRI Ocean Map"},o.a.createElement(U.a,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer/tile/{z}/{y}/{x}",attribution:"\xa9\r Esri, GEBCO, NOAA, National Geographic, DeLorme, HERE, Geonames.org, and other contributors"})),o.a.createElement(F,{name:"ESRI World Imagery"},o.a.createElement(U.a,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"\xa9\r Esri, DigitalGlobe, Earthstar Geographics, CNES/Airbus DS,\r GeoEye, USDA FSA, USGS, Aerogrid, IGN, IGP, and the GIS User Community"}))),this.renderGeojsons(),this.addLayerControls(),o.a.createElement(A,{position:"topleft"},o.a.createElement("form",{className:"leaflet-control-layers upload-form"},"Upload HRA Output Folder",o.a.createElement("input",{type:"file",ref:"fileUpload",onChange:function(t){return e.onFileUpload(t.target.files,!1)},webkitdirectory:"true",mozdirectory:"true",msdirectory:"true",odirectory:"true",directory:"true",style:{display:"none"},multiple:!0}),o.a.createElement("br",null),o.a.createElement("input",{type:"button",value:"Select Folder",onClick:function(t){return e.refs.fileUpload.click()}}),"or View Sample",o.a.createElement("input",{type:"button",value:"Sample Files",onClick:function(t){return e.viewSample(t)}}))),o.a.createElement(A,{position:"bottomleft"},o.a.createElement("div",{className:"coords"},this.state.coordText)),o.a.createElement(A,{position:"bottomright",key:"legend"},o.a.createElement("ul",{className:"legend"},this.state.legend)),o.a.createElement(D.a,{position:"bottomleft",maxWidth:100})))}}]),t}(n.Component);var q=Object(l.b)(function(e){return{csvUrl:e.csvUrl,vectorsOnMap:e.vectorsOnMap,fileSuffix:e.fileSuffix}},function(e){return Object(i.a)({getCsvUrl:T,getVectorsOnMap:L,getFileSuffix:N},e)})(Z),Y=(a(146),function(e){function t(){return Object(f.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props.title;return o.a.createElement("div",{className:"navbar"},o.a.createElement("h1",{className:"navbar-brand"},e))}}]),t}(o.a.Component)),X=a(127),J=a.n(X),$=a(128),Q=a.n($),ee=a(129),te=a(11),ae=a.n(te),ne=a(20),oe={".legend":{border:"solid silver 1px",backgroundColor:"rgba(255, 255, 255, 0.55)",borderRadius:"3px",padding:"5px",maxWidth:"200px",wordBreak:"break-all",marginLeft:"100px",float:"left",textAlign:"left"},".legend li":{width:"80%",lineHeight:"18px",paddingLeft:"20px",paddingBottom:"2px",position:"relative",fontSize:"13px",float:"left"},".legend .icon":{width:"10px",height:"10px",background:"white",borderRadius:"6px",position:"absolute",left:"3px",top:"50%",marginTop:"-6px"}},re=function(e){function t(){return Object(f.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(d.a)(t,[{key:"getList",value:function(){var e=this;return this.props.config.map(function(t,a){return o.a.createElement("li",{key:a},o.a.createElement("span",{className:"icon",style:{backgroundColor:e.getIconColor(a)}}),t.type)})}},{key:"getIconColor",value:function(e){return this.props.config[e].color}},{key:"render",value:function(){return this.props.config.length>0?o.a.createElement("div",{className:"legend-container"},o.a.createElement(ne.Style,{scopeSelector:".legend-container",rules:oe}),o.a.createElement("ul",{className:"legend"},this.getList())):null}}],[{key:"propTypes",get:function(){return{config:ae.a.array}}}]),t}(o.a.Component),se={".tooltip":{border:"solid silver 0.5px",position:"absolute",backgroundColor:"rgba(255,255,255,0.9)",borderRadius:"4px",paddingLeft:"5px",paddingRight:"5px",paddingTop:"1px",paddingBottom:"1px",display:"inline-block",fontSize:"12px",textAlign:"center"}},ie=function(e){return o.a.createElement("div",{className:"tooltip-container"},o.a.createElement(ne.Style,{scopeSelector:".tooltip-container",rules:se}),o.a.createElement("div",{className:"tooltip",style:{top:e.top,left:e.left}},e.children))},le=(a(263),function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={csvUrl:e.csvUrl,vectorsOnMap:e.vectorsOnMap,fileSuffix:e.fileSuffix,showToolTip:!1,dataToRender:{},colorConfig:[],legendColorConfig:[]},a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;null!==e.csvUrl&void 0!==e.csvUrl&&this.setState({csvUrl:e.csvUrl,vectorsOnMap:e.vectorsOnMap,fileSuffix:e.fileSuffix},function(){J.a.parse(e.csvUrl,{header:!0,download:!0,skipEmptyLines:!0,complete:function(e){return t.convertData(e.data)}})})}},{key:"convertData",value:function(e){var t=this.state.vectorsOnMap,a=this.state.fileSuffix,n={},o=[],r=[];Object.values(e).forEach(function(e){var s=e.SUBREGION,i=e.HABITAT+a;if(r.includes(i)||r.push(i),t.includes("RECLASS_RISK_"+i)||t.includes("RECLASS_RISK_Ecosystem"+a)){o.includes(i)||o.push(i);var l={type:i,stressor:e.STRESSOR,x:e.E_MEAN,y:e.C_MEAN,highRisk:e["R_%HIGH"],medRisk:e["R_%MEDIUM"],lowRisk:e["R_%LOW"]};n[s]?n[s].push(l):n[s]=[l]}}),this.setState({dataToRender:n,habitatsAll:r,habitatsOnMap:o}),this.createColorConfig()}},{key:"createColorConfig",value:function(){for(var e=this.state.habitatsAll,t=this.state.habitatsOnMap,a=Q()("tol",e.length),n=[],o=[],r=0;r<e.length;r++){var s=e[r];n.push({type:s,color:"#"+a[r]}),t.includes(s)&&o.push({type:s,color:"#"+a[r]})}n.length===e.length&&(this.setState({colorConfig:n}),this.setState({legendColorConfig:o}))}},{key:"createScatterPlot",value:function(){var e=this;if(this.state.dataToRender){var t=this.state.dataToRender;return Object.keys(t).map(function(a){var n=Math.max.apply(Math,Object.values(t[a]).map(function(e){return e.x})),r=Math.max.apply(Math,Object.values(t[a]).map(function(e){return e.y})),s=1.1*Math.max(n,r);return o.a.createElement("div",{key:a},o.a.createElement("h4",null,a),o.a.createElement(ee.ScatterplotChart,{key:a,data:t[a],margin:{top:10,right:0,bottom:25,left:65},config:e.state.colorConfig,axes:!0,xTicks:7,yTicks:7,axisLabels:{x:"Exposure",y:"Consequence"},dotRadius:6,width:400,height:300,xDomainRange:[0,s],yDomainRange:[0,s],mouseOverHandler:e.mouseOverHandler.bind(e),mouseOutHandler:e.mouseOutHandler.bind(e)}))})}}},{key:"mouseOverHandler",value:function(e,t){this.setState({showToolTip:!0,top:"".concat(t.clientY-60,"px"),left:"".concat(t.clientX-3.5*e.stressor.length,"px"),habitatName:e.type,stressorName:e.stressor,conseqValue:Number(e.y),expoValue:Number(e.x)})}},{key:"mouseOutHandler",value:function(){this.setState({showToolTip:!1})}},{key:"createTooltip",value:function(){return!!this.state.showToolTip&&o.a.createElement(ie,{top:this.state.top,left:this.state.left},o.a.createElement("span",{className:"tooltip-title"}," ",this.state.stressorName," "),o.a.createElement("br",null),o.a.createElement("span",{className:"tooltip-title"}," ",this.state.habitatName," "),o.a.createElement("br",null),"E: ",this.state.expoValue.toFixed(2),", C: ",this.state.conseqValue.toFixed(2))}},{key:"createLegend",value:function(){if(Object.values(this.state.dataToRender).length>0)return o.a.createElement("div",{className:"legend-div"},o.a.createElement(re,{config:this.state.legendColorConfig}))}},{key:"defaultParagraph",value:function(){return this.state.csvUrl?null:o.a.createElement("div",{className:"default-p"},o.a.createElement("p",null,"Welcome to the Habitat Risk Assessment visualization platform!"),o.a.createElement("p",null,"Please click on the button on the left of the map to upload your output data folder from the HRA model, in order to view the results on map and plots. You can also view sample files to expect what they look like."))}},{key:"render",value:function(){return o.a.createElement("div",{className:"plot-container"},o.a.createElement("h3",{className:"header"},"Risk Plots"),this.createLegend(),this.defaultParagraph(),this.createScatterPlot(),this.createTooltip())}}]),t}(n.Component)),ce=Object(l.b)(function(e){return{csvUrl:e.csvUrl,vectorsOnMap:e.vectorsOnMap,fileSuffix:e.fileSuffix}})(le),ue=(a(264),function(e){function t(e){var a;return Object(f.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={title:"Habitat Risk Assessment"},a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"checkBrowser",value:function(e){(!!window.chrome&&!!window.chrome.webstore)|(!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0)|"undefined"!==typeof InstallTrigger||window.alert("It is suggested to use Chrome, Opera, or Firefox to get the best performance on this web page.")}},{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement(Y,{title:this.state.title}),o.a.createElement(q,null),o.a.createElement(ce,null),o.a.createElement(b,null))}}]),t}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(265);var pe=Object(i.c)(h);s.a.render(o.a.createElement(l.a,{store:pe},o.a.createElement(ue,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[130,1,2]]]);
//# sourceMappingURL=main.b5f49277.chunk.js.map